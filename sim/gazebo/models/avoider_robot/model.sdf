<?xml version="1.0" ?>
<sdf version="1.6">
  <model name="avoider_robot">
    <pose>0 0 0.04 0 0 0</pose>
    <static>false</static>

    <!-- هيكل الروبوت -->
    <link name="base_link">
      <pose>0 0 0.04 0 0 0</pose>
      <inertial>
        <mass>0.8</mass>
        <inertia>
          <ixx>0.002</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.004</iyy><iyz>0</iyz>
          <izz>0.004</izz>
        </inertia>
      </inertial>

      <collision name="base_collision">
        <geometry>
          <box><size>0.18 0.12 0.03</size></box>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.8</mu>
              <mu2>0.8</mu2>
            </ode>
          </friction>
        </surface>
      </collision>

      <visual name="base_visual">
        <geometry>
          <box><size>0.18 0.12 0.03</size></box>
        </geometry>
        <material>
          <ambient>0 0 0.5 1</ambient>
          <diffuse>0 0 0.8 1</diffuse>
        </material>
      </visual>

      <!-- حساس Ray للأمام (بدون أي plugin) -->
      <sensor name="front_ray" type="ray">
        <pose>0.10 0 0.05 0 0 0</pose>
        <always_on>true</always_on>
        <update_rate>20</update_rate>
        <ray>
          <scan>
            <horizontal>
              <samples>21</samples>
              <resolution>1</resolution>
              <min_angle>-0.35</min_angle>
              <max_angle>0.35</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.02</min>
            <max>2.8</max>
            <resolution>0.01</resolution>
          </range>
        </ray>
      </sensor>
    </link>

    <!-- عجلة يسار -->
    <link name="left_wheel_link">
      <pose>0.0 0.07 0.05 0 1.5708 0</pose>
      <inertial>
        <mass>0.05</mass>
        <inertia>
          <ixx>1e-4</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>1e-4</iyy><iyz>0</iyz>
          <izz>1e-4</izz>
        </inertia>
      </inertial>
      <collision name="left_wheel_collision">
        <geometry>
          <cylinder><radius>0.03</radius><length>0.02</length></cylinder>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.2</mu><mu2>1.2</mu2>
            </ode>
          </friction>
        </surface>
      </collision>
      <visual name="left_wheel_visual">
        <geometry>
          <cylinder><radius>0.03</radius><length>0.02</length></cylinder>
        </geometry>
        <material>
          <ambient>0.05 0.05 0.05 1</ambient>
          <diffuse>0.05 0.05 0.05 1</diffuse>
        </material>
      </visual>
    </link>

    <!-- عجلة يمين -->
    <link name="right_wheel_link">
      <pose>0.0 -0.07 0.05 0 1.5708 0</pose>
      <inertial>
        <mass>0.05</mass>
        <inertia>
          <ixx>1e-4</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>1e-4</iyy><iyz>0</iyz>
          <izz>1e-4</izz>
        </inertia>
      </inertial>
      <collision name="right_wheel_collision">
        <geometry>
          <cylinder><radius>0.03</radius><length>0.02</length></cylinder>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>1.2</mu><mu2>1.2</mu2>
            </ode>
          </friction>
        </surface>
      </collision>
      <visual name="right_wheel_visual">
        <geometry>
          <cylinder><radius>0.03</radius><length>0.02</length></cylinder>
        </geometry>
        <material>
          <ambient>0.05 0.05 0.05 1</ambient>
          <diffuse>0.05 0.05 0.05 1</diffuse>
        </material>
      </visual>
    </link>

    <!-- مفاصل العجلات -->
    <joint name="left_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>left_wheel_link</child>
      <pose>0 0 0 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><friction>0.0</friction></dynamics>
      </axis>
    </joint>

    <joint name="right_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>right_wheel_link</child>
      <pose>0 0 0 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        <dynamics><friction>0.0</friction></dynamics>
      </axis>
    </joint>

    <!-- هنا الـ ModelPlugin وليس داخل الـ sensor -->
    <plugin name="avoider_plugin" filename="libavoider_plugin.so">
      <left_joint>left_wheel_joint</left_joint>
      <right_joint>right_wheel_joint</right_joint>
      <safe_distance>0.28</safe_distance>
      <turn_time_ms>420</turn_time_ms>
      <speed>2.2</speed>
    </plugin>
  </model>
</sdf>

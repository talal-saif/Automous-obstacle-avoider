<?xml version="1.0" ?>
<sdf version="1.6">
  <world name="aoa_world">

    <!-- الأرض والضوء -->
    <include><uri>model://ground_plane</uri></include>
    <include><uri>model://sun</uri></include>

    <!-- الروبوت -->
    <model name="aoa_bot">
      <pose>0 0 0.05 0 0 0</pose>
      <static>false</static>

      <!-- القاعدة -->
      <link name="base">
        <inertial><mass>1.0</mass></inertial>
        <collision name="col">
          <geometry><cylinder><radius>0.10</radius><length>0.05</length></cylinder></geometry>
          <surface>
            <friction><ode><mu>2.0</mu><mu2>2.0</mu2></ode></friction>
            <bounce><restitution_coefficient>0.0</restitution_coefficient><threshold>1e10</threshold></bounce>
          </surface>
        </collision>
        <visual name="vis">
          <geometry><cylinder><radius>0.10</radius><length>0.05</length></cylinder></geometry>
          <material><ambient>0.1 0.1 0.1 1</ambient></material>
        </visual>
      </link>

      <!-- العجلة اليسرى -->
      <link name="left_wheel">
        <inertial><mass>0.3</mass></inertial>
        <collision name="col">
          <geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
          <surface>
            <friction><ode><mu>2.0</mu><mu2>2.0</mu2></ode></friction>
            <bounce><restitution_coefficient>0.0</restitution_coefficient><threshold>1e10</threshold></bounce>
            <contact><ode><kp>5e4</kp><kd>1.0</kd></ode></contact>
          </surface>
        </collision>
        <visual name="vis"><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry></visual>
      </link>

      <!-- العجلة اليمنى -->
      <link name="right_wheel">
        <inertial><mass>0.3</mass></inertial>
        <collision name="col">
          <geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry>
          <surface>
            <friction><ode><mu>2.0</mu><mu2>2.0</mu2></ode></friction>
            <bounce><restitution_coefficient>0.0</restitution_coefficient><threshold>1e10</threshold></bounce>
            <contact><ode><kp>5e4</kp><kd>1.0</kd></ode></contact>
          </surface>
        </collision>
        <visual name="vis"><geometry><cylinder><radius>0.05</radius><length>0.02</length></cylinder></geometry></visual>
      </link>

      <!-- مفاصل العجلات: محور Y + damping -->
      <joint name="left_hinge" type="revolute">
        <parent>base</parent><child>left_wheel</child>
        <pose>0 0.12 -0.05 0 0 0</pose>
        <axis><xyz>0 1 0</xyz><limit><lower>-1e16</lower><upper>1e16</upper></limit><dynamics><damping>0.8</damping></dynamics></axis>
      </joint>
      <joint name="right_hinge" type="revolute">
        <parent>base</parent><child>right_wheel</child>
        <pose>0 -0.12 -0.05 0 0 0</pose>
        <axis><xyz>0 1 0</xyz><limit><lower>-1e16</lower><upper>1e16</upper></limit><dynamics><damping>0.8</damping></dynamics></axis>
      </joint>

      <!-- LiDAR مثبت فوق القاعدة -->
      <link name="lidar_link">
        <pose>0 0 0.10 0 0 0</pose>
        <inertial><mass>0.05</mass></inertial>
        <visual name="lidar_vis">
          <geometry><cylinder><radius>0.02</radius><length>0.02</length></cylinder></geometry>
          <material><ambient>0.2 0.6 0.9 1</ambient></material>
        </visual>

        <!-- المستشعر: Ray LiDAR -->
        <sensor name="aoa_lidar" type="ray">
          <always_on>true</always_on>
          <update_rate>15</update_rate>
          <visualize>true</visualize> <!-- يبين شعاعات الليدار في GUI -->
          <topic>~/aoa_lidar</topic>

          <ray>
            <scan>
              <!-- 270° FOV، 270 عيّنة -->
              <horizontal>
                <samples>270</samples>
                <resolution>1</resolution>
                <min_angle>-2.35619</min_angle> <!-- -135° -->
                <max_angle> 2.35619</max_angle> <!-- +135° -->
              </horizontal>
            </scan>
            <range>
              <min>0.05</min>
              <max>6.0</max>
              <resolution>0.01</resolution>
            </range>
            <noise> <!-- ضوضاء بسيطة واقعية -->
              <type>gaussian</type>
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </noise>
          </ray>
        </sensor>
      </link>

      <!-- ثبّت الليدار بالقاعدة -->
      <joint name="lidar_mount" type="fixed">
        <parent>base</parent>
        <child>lidar_link</child>
      </joint>

      <!-- البلجن (نفسه) -->
      <plugin name="aoa_plugin" filename="libaoa_plugin.so"/>
    </model>

    <!-- عقبات -->
    <model name="box1">
      <pose>1.5 0 0.05 0 0 0</pose><static>true</static>
      <link name="link">
        <collision name="collision"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></collision>
        <visual name="visual"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></visual>
      </link>
    </model>
    <model name="box2">
      <pose>2.8 0.3 0.05 0 0 0</pose><static>true</static>
      <link name="link">
        <collision name="collision"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></collision>
        <visual name="visual"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></visual>
      </link>
    </model>
    <model name="box3">
      <pose>4.0 -0.4 0.05 0 0 0</pose><static>true</static>
      <link name="link">
        <collision name="collision"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></collision>
        <visual name="visual"><geometry><box><size>0.3 0.3 0.3</size></box></geometry></visual>
      </link>
    </model>

  </world>
</sdf>
